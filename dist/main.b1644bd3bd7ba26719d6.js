!function(t){function e(e){for(var n,s,c=e[0],o=e[1],l=e[2],u=0,m=[];u<c.length;u++)s=c[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&m.push(r[s][0]),r[s]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);for(d&&d(e);m.length;)m.shift()();return a.push.apply(a,l||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,c=1;c<i.length;c++){var o=i[c];0!==r[o]&&(n=!1)}n&&(a.splice(e--,1),t=s(s.s=i[0]))}return t}var n={},r={0:0},a=[];function s(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=n,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var c=window.webpackJsonp=window.webpackJsonp||[],o=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var d=o;a.push([31,1]),i()}({10:function(t,e,i){},31:function(t,e,i){"use strict";i.r(e);i(10);var n=i(1),r=i.n(n);var a={url:"https://aviasales-api.herokuapp.com"};var s=new class{constructor(t){this.url=t.url}async countries(){try{return(await r.a.get(`${this.url}/countries`)).data}catch(t){return Promise.reject(t)}}async cities(){try{return(await r.a.get(`${this.url}/cities`)).data}catch(t){return Promise.reject(t)}}async airlines(){try{return(await r.a.get(`${this.url}/airlines`)).data}catch(t){return Promise.reject(t)}}async prices(t){try{return(await r.a.get(`${this.url}/prices/cheap`,{params:t})).data}catch(t){return Promise.reject(t)}}}(a),c=i(33);var o=new class{constructor(t,e){this.api=t,this.countries=null,this.cities=null,this.lastSearch={},this.formatDate=e.formatDate}async init(){const t=await Promise.all([this.api.countries(),this.api.cities(),this.api.airlines()]),[e,i,n]=t;return this.countries=this.serializeCountries(e),this.cities=this.serializeCities(i),this.shortCitiesList=this.createShortCitiesList(this.cities),this.airlines=this.serializeAirlines(n),console.log("init epta"),t}createShortCitiesList(t){return Object.entries(t).reduce((t,[,e])=>(t[e.full_name]=null,t),{})}getCityCodeByKey(t){return Object.values(this.cities).find(e=>e.full_name===t).code}getCityNameByCode(t){return this.cities[t].name}getAirlineByCode(t){return this.airlines[t].name||""}getAirlinesLogo(t){return this.airlines[t].logo||""}serializeAirlines(t){return t.reduce((t,e)=>(e.logo=`http://pics.avs.io/200/200/${e.code}.png`,e.name=e.name||e.name_translations.en,t[e.code]=e,t),{})}async fetchTickest(t){const e=await this.api.prices(t);this.lastSearch=this.serializeTicets(e.data)}serializeTicets(t){return Object.values(t).map(t=>({...t,origin_name:this.getCityNameByCode(t.origin),destination_name:this.getCityNameByCode(t.destination),airline_logo:this.getAirlinesLogo(t.airline),airline_name:this.getAirlineByCode(t.airline),departure_at:this.formatDate(t.departure_at,"dd-MMM-yyyy hh:mm"),return_at:this.formatDate(t.return_at,"dd-MMM-yyyy hh:mm"),id:`tiket${Math.random()+10*Math.random()}`}))}serializeCountries(t){return t.reduce((t,e)=>(t[e.code]=e,t),{})}serializeCities(t){return t.reduce((t,e)=>{const i=this.getCountryNameByCode(e.country_code),n=`${e.name||e.name_translations.en}, ${i}`;return t[e.code]={...e,country_name:i,full_name:n},t},{})}getCountryNameByCode(t){return this.countries[t].name}}(s,{formatDate:function(t,e){const i=new Date(t);return Object(c.a)(i,e)}});i(28),i(29);const l=document.querySelectorAll(".dropdown-trigger");M.Dropdown.init(l);const d=document.querySelectorAll("select");M.FormSelect.init(d);const u=document.querySelectorAll(".autocomplete");M.Autocomplete.init(u);const m=document.querySelectorAll(".datepicker");M.Datepicker.init(m,{showClearBtn:!0,format:"yyyy-mm"});var p=new class{constructor(t,e){this._form=document.forms["location-control"],this.origin=document.getElementById("autocomplete-origin"),this.destination=document.getElementById("autocomplete-destination"),this.depart=document.getElementById("datepicker-depart"),this.return=document.getElementById("datepicker-return"),this.originAutocomplete=e(this.origin),this.destinationAutocomplete=e(this.destination),this.departDate=t(this.depart),this.returnDate=t(this.return)}get form(){return this._form}setAutocomleteDate(t){this.originAutocomplete.updateData(t),this.destinationAutocomplete.updateData(t)}get originValue(){return this.origin.value}get destinationValue(){return this.destination.value}get departValue(){return this.departDate.toString()}get returnValue(){return this.returnDate.toString()}}((function(t){return M.Datepicker.getInstance(t)}),(function(t){return M.Autocomplete.getInstance(t)}));var h=new class{constructor(){this.currency=document.getElementById("currency"),this.dictionary={USD:"$",EUR:"€"}}get currencyValue(){return this.currency.value}getCurrencySymbol(){return this.dictionary[this.currencyValue]}};class f{constructor(t){this.container=document.querySelector(".tickets-sections .row"),this.getCurrencySymbol=t.getCurrencySymbol.bind(t)}renderTickets(t){if(this.clearContainer(),!t.length)return void this.showEmptyMsg();let e="";const i=this.getCurrencySymbol();t.forEach((t,n)=>{const r=f.ticketTamplate(t,i,n);e+=r}),this.container.insertAdjacentHTML("afterbegin",e)}clearContainer(){this.container.innerHTML=""}showEmptyMsg(){const t=f.emptyMsgTemplate();this.container.insertAdjacentHTML("afterbegin",t)}static emptyMsgTemplate(){return'\n    <div class ="tickets-empty-res-msg">\n    По вашему запросу билетов не найденою.\n    </div>\n    '}static ticketTamplate(t,e){return`\n    <div class="col s12 m6">\n            <div class="card ticket-card" data-id="${t.id}">\n              <div class="ticket-airline d-flex align-items-center">\n                <img\n                  src="${t.airline_logo}"\n                  class="ticket-airline-img"\n                />\n                <span class="ticket-airline-name"\n                  >${t.airline_name}</span\n                >\n              </div>\n              <div class="ticket-destination d-flex align-items-center">\n                <div class="d-flex align-items-center mr-auto">\n                  <span class="ticket-city">${t.origin_name}</span>\n                  <i class="medium material-icons">flight_takeoff</i>\n                </div>\n                <div class="d-flex align-items-center">\n                  <i class="medium material-icons">flight_land</i>\n                  <span class="ticket-city">${t.destination_name}</span>\n                </div>\n              </div>\n              <div class="ticket-time-price d-flex align-items-center">\n                <span class="ticket-time-departure">${t.departure_at}</span>\n                <span class="ticket-price ml-auto">${e} ${t.price}</span>\n              </div>\n              <div class="ticket-additional-info">\n                <span class="ticket-transfers">Пересадок: ${t.transfers}</span>\n                <span class="ticket-flight-number">Номер рейса: ${t.flight_number}</span>\n              </div>\n              <a\n                class="waves-effect waves-light btn-small green darken-1 add-favorite ml-auto"\n                >Add to favorites</a\n              >\n            </div>\n          </div>`}}var g=new f(h);var y=new class{constructor(){this.favoriteTickets=[]}get favoriteTiketsData(){return this.favoriteTickets}set favoriteTiket(t){this.favoriteTickets.some(e=>e.id===t.id)||this.favoriteTickets.push(t)}deleteFavoriteTickets(t){const e=this.favoriteTickets.filter(e=>e.id!==t);this.favoriteTickets=e}};var v=new class{constructor(t){this.container=document.querySelector(".dropdown-content"),this.currency=h.getCurrencySymbol.bind(h)}renderFavoritTemplate(t){if(this.clearContainer(),!t.length)return void this.renderEmptyMsg();let e="";t.forEach(t=>{const i=this.createFavoritTicketTemplate(t);e+=i}),this.container.insertAdjacentHTML("afterbegin",e)}clearContainer(){this.container.innerHTML=""}emptyTemplateMsg(){return'<p class="dropdown-empty-msg">Список пуст</p>'}renderEmptyMsg(){const t=this.emptyTemplateMsg();this.container.insertAdjacentHTML("afterbegin",t)}createFavoritTicketTemplate(t){return`\n    <div data-id = "${t.id}" class="favorite-item d-flex align-items-start" >\n              <img\n                src="${t.airline_logo}"\n                class="favorite-item-airline-img"\n              />\n              <div class="favorite-item-info d-flex flex-column">\n                <div\n                  class="favorite-item-destination d-flex align-items-center"\n                >\n                  <div class="d-flex align-items-center mr-auto">\n                    <span class="favorite-item-city">${t.origin_name}</span>\n                    <i class="medium material-icons">flight_takeoff</i>\n                  </div>\n                  <div class="d-flex align-items-center">\n                    <i class="medium material-icons">flight_land</i>\n                    <span class="favorite-item-city">${t.destination_name}</span>\n                  </div>\n                </div>\n                <div class="ticket-time-price d-flex align-items-center">\n                  <span class="ticket-time-departure">${t.departure_at}</span>\n                  <span class="ticket-price ml-auto">${t.price}</span>\n                </div>\n                <div class="ticket-additional-info">\n                  <span class="ticket-transfers">Пересадок: ${t.transfers}</span>\n                  <span class="ticket-flight-number">Номер рейса: ${t.flight_number}</span>\n                </div>\n                <a\n                  class="waves-effect waves-light btn-small pink darken-3 delete-favorite ml-auto"\n                  >Delete</a\n                >\n              </div>\n            </div>\n    `}}(currency);document.addEventListener("DOMContentLoaded",()=>{!async function(){await o.init(),p.setAutocomleteDate(o.shortCitiesList)}(),p.form.addEventListener("submit",t=>{t.preventDefault(),async function(){const t=o.getCityCodeByKey(p.originValue),e=o.getCityCodeByKey(p.destinationValue),i=p.departValue,n=p.returnValue,r=h.currencyValue;await o.fetchTickest({origin:t,destination:e,depart_date:i,return_date:n,currency:r}),g.renderTickets(o.lastSearch)}()})}),document.querySelector(".tickets-sections .container .row").addEventListener("click",({target:t})=>{if(t.classList.contains("add-favorite")){const e=t.parentElement.dataset.id,i=o.lastSearch.find(t=>t.id===e);y.favoriteTiket=i;const n=y.favoriteTiketsData;v.renderFavoritTemplate(n)}}),document.querySelector(".dropdown-content").addEventListener("click",({target:t})=>{if(t.classList.contains("delete-favorite")){const e=t.parentElement.parentElement.dataset.id;y.deleteFavoriteTickets(e);const i=y.favoriteTiketsData;v.renderFavoritTemplate(i)}})}});